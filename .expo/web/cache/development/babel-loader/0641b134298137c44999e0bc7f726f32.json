{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport createDataContext from \"./createDataContext\";\nimport backend from \"../api/backend\";\nimport AsyncStorage from \"react-native-web/dist/exports/AsyncStorage\";\nimport { navigate } from \"../navigationRef\";\n\nvar authReducer = function authReducer(state, action) {\n  switch (action.type) {\n    case \"signup_error\":\n      return _objectSpread(_objectSpread({}, state), {}, {\n        errorMessage: action.payload\n      });\n\n    case 'signup':\n      return _objectSpread(_objectSpread({}, state), {}, {\n        token: action.payload\n      });\n\n    case 'signin':\n      return _objectSpread(_objectSpread({}, state), {}, {\n        token: action.payload\n      });\n\n    case 'sigin_error':\n      return _objectSpread(_objectSpread({}, state), {}, {\n        errorMessage: action.payload\n      });\n\n    case 'logout':\n      return {\n        token: null\n      };\n\n    case 'getMe':\n      return _objectSpread(_objectSpread({}, state), {}, {\n        userMe: action.payload\n      });\n\n    default:\n      return state;\n  }\n\n  ;\n};\n\nvar localSigin = function localSigin(dispatch) {\n  return function _callee() {\n    var token;\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem('token'));\n\n          case 2:\n            token = _context.sent;\n\n            if (token) {\n              dispatch({\n                type: 'signin',\n                payload: token\n              });\n              navigate('home');\n            } else {\n              navigate('loginFlow');\n            }\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n};\n\nvar signup = function signup(dispatch) {\n  return function _callee2(_ref) {\n    var name, email, password, response;\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            name = _ref.name, email = _ref.email, password = _ref.password;\n            _context2.prev = 1;\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(backend.post('/api/v1/auth/register', {\n              name: name,\n              email: email,\n              password: password\n            }));\n\n          case 4:\n            response = _context2.sent;\n            console.log(\"succ\");\n            console.log(response.data);\n            _context2.next = 9;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem('token', response.data.token));\n\n          case 9:\n            dispatch({\n              type: \"signup\",\n              payload: response.data.token\n            });\n            navigate('home');\n            _context2.next = 17;\n            break;\n\n          case 13:\n            _context2.prev = 13;\n            _context2.t0 = _context2[\"catch\"](1);\n            console.log(_context2.t0.response);\n            dispatch({\n              type: \"signup_error\",\n              payload: \"err msg\"\n            });\n\n          case 17:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[1, 13]], Promise);\n  };\n};\n\nvar signin = function signin(dispatch) {\n  return function _callee3(_ref2) {\n    var email, password, response;\n    return _regeneratorRuntime.async(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            email = _ref2.email, password = _ref2.password;\n            _context3.prev = 1;\n            _context3.next = 4;\n            return _regeneratorRuntime.awrap(backend.post('/api/v1/auth/login', {\n              email: email,\n              password: password\n            }));\n\n          case 4:\n            response = _context3.sent;\n            console.log(\"succ\");\n            console.log(response.data);\n            _context3.next = 9;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem('token', response.data.token));\n\n          case 9:\n            dispatch({\n              type: \"signin\",\n              payload: response.data.token\n            });\n            navigate('home');\n            _context3.next = 17;\n            break;\n\n          case 13:\n            _context3.prev = 13;\n            _context3.t0 = _context3[\"catch\"](1);\n            console.log(_context3.t0.response);\n            dispatch({\n              type: \"sigin_error\",\n              payload: \"err msg\"\n            });\n\n          case 17:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[1, 13]], Promise);\n  };\n};\n\nvar logout = function logout(dispatch) {\n  return function _callee4() {\n    return _regeneratorRuntime.async(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return _regeneratorRuntime.awrap(AsyncStorage.removeItem('token'));\n\n          case 2:\n            dispatch({\n              type: 'logout'\n            });\n            navigate('loginFlow');\n\n          case 4:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n};\n\nvar getMe = function getMe(dispatch) {\n  return function _callee5() {\n    var token, response;\n    return _regeneratorRuntime.async(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.prev = 0;\n            _context5.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem('token'));\n\n          case 3:\n            token = _context5.sent;\n            _context5.next = 6;\n            return _regeneratorRuntime.awrap(backend.get('/api/v1/auth/me', {\n              headers: {\n                'Content-Type': 'application/json',\n                'Authorization': \"Bearer \" + token\n              }\n            }));\n\n          case 6:\n            response = _context5.sent;\n            console.log(\"succ\");\n            console.log(response.data.data);\n            dispatch({\n              type: \"getMe\",\n              payload: response.data.data\n            });\n            _context5.next = 15;\n            break;\n\n          case 12:\n            _context5.prev = 12;\n            _context5.t0 = _context5[\"catch\"](0);\n            console.log(_context5.t0.response);\n\n          case 15:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, null, null, [[0, 12]], Promise);\n  };\n};\n\nvar _createDataContext = createDataContext(authReducer, {\n  signin: signin,\n  signup: signup,\n  logout: logout,\n  localSigin: localSigin,\n  getMe: getMe\n}, {\n  token: null,\n  errorMessage: '',\n  userMe: null\n}),\n    Context = _createDataContext.Context,\n    Provider = _createDataContext.Provider;\n\nexport { Context, Provider };","map":{"version":3,"sources":["/home/sakka/Documents/app/src/context/AuthContext.js"],"names":["createDataContext","backend","navigate","authReducer","state","action","type","errorMessage","payload","token","userMe","localSigin","dispatch","AsyncStorage","getItem","signup","name","email","password","post","response","console","log","data","setItem","signin","logout","removeItem","getMe","get","headers","Context","Provider"],"mappings":"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","sourcesContent":["import createDataContext from './createDataContext';\nimport backend from '../api/backend';\nimport {AsyncStorage} from 'react-native';\n\nimport {navigate} from '../navigationRef';\n\nconst authReducer =(state,action)=>{\n\n    switch(action.type){\n        case \"signup_error\":\n            return({...state,errorMessage:action.payload}); // overiding the errorMessage with the payload\n        case 'signup':\n            return({...state,token:action.payload});\n        \n        case 'signin':\n            return({...state,token:action.payload});\n        case 'sigin_error':\n            return({...state,errorMessage:action.payload});\n        case 'logout':\n            return({token:null});\n        case 'getMe':\n            //console.log(\"look here\");\n            //console.log(action.payload);\n            return({...state,userMe:action.payload});\n        default:\n            return(state);\n    };\n};\n\nconst localSigin = (dispatch)=>{\n    return (\n        async () =>{\n            const token = await AsyncStorage.getItem('token');\n            if (token) {\n                dispatch ({type:'signin',payload:token})\n                //navigate to main flow \n                navigate('home');\n            } else {\n                //navigate to login flow \n                navigate('loginFlow');\n            }\n        }\n    );\n}\n\nconst signup = (dispatch)=>{\n\n    return(\n        async  ({name,email,password})=>{\n       \n        try {\n            // api/register requesst \n            const response =await backend.post ('/api/v1/auth/register',{name,email,password});\n            console.log(\"succ\");\n            console.log(response.data); \n\n            //storing the token in storage\n            await AsyncStorage.setItem('token',response.data.token);\n            \n            //update state authenticate \n            dispatch({type:\"signup\",payload:response.data.token});\n\n            //navigate to main flow \n            navigate('home');\n              \n        } catch (error) {\n            //fail return error msg            \n            console.log(error.response);\n            dispatch({type:\"signup_error\",payload:\"err msg\"})\n        }\n            \n       \n        }\n    );\n}\n\n\nconst signin = (dispatch)=>{\n\n    return(\n        async ({email,password})=>{\n            try {\n                // api/logIn requesst \n                const response =await backend.post('/api/v1/auth/login',{email,password});\n                console.log(\"succ\");\n                console.log(response.data); \n\n                //storing the token in storage\n                await AsyncStorage.setItem('token',response.data.token);\n\n                //update state authenticate \n                dispatch({type:\"signin\",payload:response.data.token});\n\n                //navigate to main flow \n                navigate('home');\n            } catch (error) {\n\n            //fail return error msg \n            console.log(error.response);\n            dispatch({type:\"sigin_error\",payload:\"err msg\"})\n            }\n        }\n    );\n}\n\n\nconst logout = (dispatch)=>{\n\n    return(\n        async () => {\n            // api/logOut requesst \n            await AsyncStorage.removeItem('token');\n            dispatch({type:'logout'})\n            //update state authenticate \n            //navigate to login flow \n            navigate('loginFlow');\n            //fail return error msg \n        }\n    );\n}\n\nconst getMe = (dispatch)=>{\n\n    return(\n        async ()=>{\n            try {\n                //get token from storage\n                const token = await AsyncStorage.getItem('token');\n                // api/logIn requesst \n                const response =await backend.get('/api/v1/auth/me',{\n                    headers: {'Content-Type': 'application/json','Authorization':`Bearer ${token}`}\n                });\n                console.log(\"succ\");\n                console.log(response.data.data); \n\n                //update state authenticate \n               dispatch({type:\"getMe\",payload:response.data.data});\n\n            \n            } catch (error) {\n\n            //fail return error msg \n            console.log(error.response);\n            }\n        }\n    );\n}\n\nexport const {Context,Provider} = createDataContext(\n    authReducer,\n    {signin,signup,logout,localSigin,getMe},\n    {token:null,errorMessage:'',userMe:null}\n);"]},"metadata":{},"sourceType":"module"}